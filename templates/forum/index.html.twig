{% extends 'base.html.twig' %}

{% block title %}Forum Communautaire{% endblock %}

{% block body %}
<div class="forum-container">
    <div class="forum-wrapper">
        <!-- Header Section -->
        <div class="forum-header">
            <h1 class="forum-title">Forum Communautaire</h1>
            <p class="forum-description">
                Partagez vos expériences, posez vos questions et discutez avec la communauté.
            </p>

            <!-- New Topic Button -->
            {% if app.user %}
                <button onclick="toggleNewTopicForm()" class="btn-new-topic">
                    + Nouveau sujet
                </button>
            {% else %}
                <p class="forum-login-prompt">
                    <a href="{{ path('app_login') }}" class="link-login">Connectez-vous</a> pour créer un sujet
                </p>
            {% endif %}
        </div>

        <!-- New Topic Form -->
        {% if app.user %}
            <div id="newTopicForm" class="forum-form-container hidden">
                <h2 class="forum-form-title">Créer un nouveau sujet</h2>
                
                <form method="POST" action="{{ path('app_forum_create_topic') }}">
                    <div class="form-group">
                        <label class="form-label">Titre</label>
                        <input type="text" name="title" placeholder="Entrez le titre du sujet..." required
                            class="form-input" />
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea name="description" placeholder="Décrivez votre sujet en détail..." required
                            class="form-textarea"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-submit">
                            Créer le sujet
                        </button>
                        <button type="button" onclick="toggleNewTopicForm()" class="btn-cancel">
                            Annuler
                        </button>
                    </div>
                </form>
            </div>
        {% endif %}

        <!-- Topics List -->
        <div class="topics-list">
            {% if topics is empty %}
                <div class="topics-empty">
                    <p>Aucun sujet pour le moment. Soyez le premier à en créer un !</p>
                </div>
            {% else %}
                {% for item in topics %}
                    <a href="{{ path('app_topic', { id: item.id }) }}" class="topic-link">
                        <div class="topic-card">
                            <div class="topic-content">
                                <div class="topic-author">
                                    <!-- Author Info -->
                                    <div class="author-avatar">
                                        {{ item.user.nom|first|upper }}{{ item.user.prenom|first|upper }}
                                    </div>
                                    <div class="author-info">
                                        <p class="author-name">
                                            {{ item.user.nom }} {{ item.user.prenom }}
                                        </p>
                                        <p class="author-date">
                                            {{ item.createdAt|date('d/m/Y') }}
                                        </p>
                                    </div>
                                </div>

                                <!-- Topic Title and Description -->
                                <h3 class="topic-title">
                                    {{ item.title }}
                                </h3>
                                <p class="topic-description">
                                    {{ item.description }}
                                </p>
                            </div>

                            <!-- Vote and Comment Stats -->
                            <div class="topic-stats">
                                <div class="votes-container">
                                    <div class="vote-item upvote">
                                        <svg class="vote-icon" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M2 10.5a1.5 1.5 0 113 0v-7a1.5 1.5 0 00-3 0v7zM14 4a1 1 0 011 1v12a1 1 0 11-2 0V5a1 1 0 011-1zm-4-1a1 1 0 00-1 1v5a1 1 0 102 0V4a1 1 0 00-1-1z"></path>
                                        </svg>
                                        <span class="vote-count">{{ item.upvotes }}</span>
                                    </div>
                                    <div class="vote-item downvote">
                                        <svg class="vote-icon" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M2 9.5a1.5 1.5 0 113 0v7a1.5 1.5 0 01-3 0v-7zM14 16a1 1 0 011-1v-12a1 1 0 11-2 0v12a1 1 0 011 1zm-4 1a1 1 0 00-1-1v-5a1 1 0 102 0v5a1 1 0 00-1 1z"></path>
                                        </svg>
                                        <span class="vote-count">{{ item.downvotes }}</span>
                                    </div>
                                </div>
                                <div class="comments-count">
                                    <svg class="comment-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                                    </svg>
                                    <span>{{ item.comments|length }} commentaires</span>
                                </div>
                            </div>
                        </div>
                    </a>
                {% endfor %}
            {% endif %}
        </div>
    </div>
</div>

<script>
function toggleNewTopicForm() {
    const form = document.getElementById('newTopicForm');
    form.classList.toggle('hidden');
}
</script>
{% endblock %}
